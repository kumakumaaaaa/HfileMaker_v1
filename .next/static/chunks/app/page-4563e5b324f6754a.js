(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6387:(e,t,a)=>{Promise.resolve().then(a.bind(a,6709))},6709:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eo});var s=a(5155),l=a(2115),r=a(6802),n=a(6943),o=a(6962),i=a(7646),d=a(3063);let c=e=>{let{activeTab:t,onTabChange:a}=e,l=[{id:"home",label:"ホーム",icon:r.A},{id:"patients",label:"患者管理",icon:n.A},{id:"inpatients",label:"入院患者",icon:o.A},{id:"wards",label:"病棟・病室",icon:i.A},{id:"settings",label:"マスタ設定",icon:d.A}];return(0,s.jsxs)("header",{className:"bg-white border-b border-gray-200 h-14 flex items-center px-4 shrink-0 relative z-50",children:[(0,s.jsx)("div",{className:"font-bold text-xl mr-8 text-blue-900",children:"HfileMaker"}),(0,s.jsx)("nav",{className:"flex h-full",children:l.map(e=>{let l=t===e.id,r=e.icon;return(0,s.jsxs)("button",{onClick:()=>a(e.id),className:"\n                flex items-center gap-2 px-4 h-full border-b-2 text-lg font-bold transition-colors\n                ".concat(l?"border-blue-600 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50","\n              "),children:[(0,s.jsx)(r,{className:"w-5 h-5"}),e.label]},e.id)})}),(0,s.jsx)("div",{className:"ml-auto flex items-center gap-4 text-xs text-gray-400",children:"Demo User"})]})},x=[{id:"a_wounds",category:"a",label:"創傷処置",points:1,inputType:"checkbox"},{id:"a_respiratory",category:"a",label:"呼吸ケア",points:1,inputType:"checkbox"},{id:"a_infusion",category:"a",label:"点滴ライン同時3本以上の管理",points:1,inputType:"checkbox"},{id:"a_ecg",category:"a",label:"心電図モニターの管理",points:1,inputType:"checkbox"},{id:"a_syringe_driver",category:"a",label:"シリンジポンプの管理",points:1,inputType:"checkbox"},{id:"a_emergency",category:"a",label:"救急搬送後の入院/緊急入院(2日間)",points:2,inputType:"checkbox"},{id:"a_special",category:"a",label:"専門的な治療・処置(抗悪性腫瘍剤等)",points:3,inputType:"checkbox"},{id:"b_bed_mobility",category:"b",label:"寝返り",points:2,inputType:"select",hasAssistance:!1,options:[{label:"できる(0点)",value:0,explanation:"手すり等を使わずに自力で寝返りができる"},{label:"何かにつかまればできる(1点)",value:1,explanation:"柵や介助バーを使用すれば可能"},{label:"できない(2点)",value:2,explanation:"自力では全くできない、または医学的安静で禁止されている"}]},{id:"b_transfer",category:"b",label:"移乗",points:2,inputType:"select",hasAssistance:!0,options:[{label:"自立(0点)",value:0,explanation:"乗り移り動作が自力で可能、または介助不要"},{label:"一部介助(1点)",value:1,explanation:"見守りや手を添える程度の介助が必要"},{label:"全介助(2点)",value:2,explanation:"抱え上げなど、人的な力が全面的に必要"}]},{id:"b_oral_care",category:"b",label:"口腔清潔",points:1,inputType:"select",hasAssistance:!0,options:[{label:"自立(0点)",value:0,explanation:"準備から実施まで一人で完結できる"},{label:"要介助(1点)",value:1,explanation:"物品の準備や仕上げ磨きなどに介助が必要"}]},{id:"b_eating",category:"b",label:"食事摂取",points:2,inputType:"select",hasAssistance:!0,options:[{label:"自立(0点)",value:0,explanation:"配膳された食事を自力で摂取できる"},{label:"一部介助(1点)",value:1,explanation:"小さく刻む、蓋を開ける、一部介助などが必要"},{label:"全介助(2点)",value:2,explanation:"経管栄養を含む、全ての摂取に介助が必要"}]},{id:"b_clothes",category:"b",label:"衣服の着脱",points:2,inputType:"select",hasAssistance:!0,options:[{label:"自立(0点)",value:0,explanation:"ボタン留め等含め、全て一人で可能"},{label:"一部介助(1点)",value:1,explanation:"背中を整える、靴下を履くなどに介助が必要"},{label:"全介助(2点)",value:2,explanation:"自分では着脱がほとんどできない"}]},{id:"b_instruction",category:"b",label:"診療・療養上の指示が通じる",points:1,inputType:"select",hasAssistance:!1,options:[{label:"はい(0点)",value:0},{label:"いいえ(1点)",value:1}]},{id:"b_danger",category:"b",label:"危険行動",points:2,inputType:"select",hasAssistance:!1,options:[{label:"ない(0点)",value:0},{label:"ある(2点)",value:2}]},{id:"c_thoraco",category:"c",label:"開胸手術(9日間)",points:1,inputType:"checkbox"},{id:"c_laparo",category:"c",label:"開腹手術(6日間)",points:1,inputType:"checkbox"},{id:"c_craniotomy",category:"c",label:"開頭手術(11日間)",points:1,inputType:"checkbox"},{id:"c_other_surgery",category:"c",label:"その他手術(5日間)",points:1,inputType:"checkbox"}],m={ACUTE_GENERAL_5:{id:"acute_general_5",name:"急性期一般入院料5",thresholds:{pattern1:{a:2,b:3},pattern2:{c:1}}}},g="nursing_patients_v7",u="nursing_admissions_v7",b="nursing_wards_v1",h="nursing_rooms_v1",p="nursing_users_v1",f="nursing_assessment_",y=[{code:"W001",name:"一般病棟（東）",type:"一般病棟"},{code:"W002",name:"一般病棟（西）",type:"一般病棟"},{code:"W003",name:"精神科病棟",type:"精神病棟"},{code:"W004",name:"療養病棟",type:"その他"}],j=[{code:"101",name:"101"},{code:"102",name:"102"},{code:"103",name:"103"},{code:"201",name:"201"},{code:"202",name:"202"},{code:"203",name:"203"},{code:"205",name:"205"},{code:"206",name:"206"},{code:"301",name:"301"},{code:"302",name:"302"},{code:"303",name:"303"},{code:"N101",name:"西101"},{code:"N102",name:"西102"},{code:"E101",name:"東101"},{code:"E102",name:"東102"}],v=()=>{let e=localStorage.getItem(b);return e?JSON.parse(e):y},N=()=>{let e=localStorage.getItem(h);return e?JSON.parse(e):j},w=[{id:"u1",userId:"admin",name:"システム管理者",password:"password",role:"管理者",authority:"システム管理者アカウント"},{id:"u2",userId:"manager",name:"施設管理者",password:"password",role:"管理者",authority:"施設管理者アカウント"},{id:"u3",userId:"staff1",name:"看護 太郎",password:"password",role:"評価者",authority:"一般アカウント"},{id:"u4",userId:"staff2",name:"医療 花子",password:"password",role:"入力者",authority:"一般アカウント"}],S=()=>{let e=localStorage.getItem(p);return e?JSON.parse(e):w},k=e=>{let t;e.id||(e.id="p"+Math.random().toString(36).substr(2,9));let a=C(),s=a.findIndex(t=>t.id===e.id);return s>=0?(t=[...a])[s]=e:t=[...a,e],localStorage.setItem(g,JSON.stringify(t)),e},D=(e,t)=>{let a=[...A(null).filter(t=>t.patientId!==e),...t.map(t=>({...t,id:t.id.startsWith("temp_")?"adm"+Math.random().toString(36).substr(2,9):t.id,patientId:e}))];localStorage.setItem(u,JSON.stringify(a))},C=()=>{let e=localStorage.getItem(g);return e?JSON.parse(e):[]},A=e=>{let t=localStorage.getItem(u),a=t?JSON.parse(t):[];return null===e?a:a.filter(t=>t.patientId===e)},_=(e,t)=>"".concat(f).concat(e,"_").concat(t),I=(e,t)=>{let a=_(e,t);localStorage.removeItem(a)};function E(e,t){var a,s,l,r,n,o;let i=0,d=0,c=0,g=t.items||{};x.forEach(e=>{let t=g[e.id];if("a"===e.category)!0===t&&(i+=e.points);else if("c"===e.category)!0===t&&(c+=e.points);else if("b"===e.category&&"number"==typeof t){let a=t;if(e.hasAssistance){let t=g["".concat(e.id,"_assist")];a*="number"==typeof t?t:0}d+=a}});let u=null!=(a=t.scoreA)?a:i,b=null!=(s=t.scoreB)?s:d,h=null!=(l=t.scoreC)?l:c;if(e===m.ACUTE_GENERAL_5.id){let e=m.ACUTE_GENERAL_5.thresholds,t=u>=(null!=(r=e.pattern1.a)?r:0)&&b>=(null!=(n=e.pattern1.b)?n:0),a=h>=(null!=(o=e.pattern2.c)?o:0);return t||a}return console.warn("Unknown admission fee ID: ".concat(e)),!1}let O=e=>{var t;let{item:a,currentValue:r,currentAssistValue:n,onSave:o,onClose:i,position:d}=e,c=(0,l.useRef)(null),[x,m]=l.useState(r),[g,u]=l.useState(null!=n?n:1);(0,l.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&i()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[i]);let[b,h]=l.useState({top:d.y,left:d.x,opacity:0,zIndex:1e3});return(0,l.useLayoutEffect)(()=>{if(c.current){let e=c.current.getBoundingClientRect(),t=window.innerHeight,a=d.y,s=d.x;e.bottom>t&&(a=d.y-e.height)<0&&(a=10),e.right>window.innerWidth&&(s=window.innerWidth-e.width-10),h({top:a,left:s,opacity:1,zIndex:1e3})}},[d]),(0,s.jsxs)("div",{ref:c,className:"fixed bg-white border border-gray-300 shadow-xl rounded-lg p-4 w-80 text-sm animate-in fade-in zoom-in-95 duration-100",style:b,children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-gray-100",children:[(0,s.jsx)("h3",{className:"font-bold text-gray-800",children:a.label}),(0,s.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[a.hasAssistance&&(0,s.jsxs)("div",{className:"bg-orange-50 p-2 rounded border border-orange-200 mb-2",children:[(0,s.jsx)("span",{className:"text-xs font-bold text-orange-800 block mb-1",children:"介助の実施"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>u(1),className:"flex-1 py-1 px-2 rounded text-xs border ".concat(1===g?"bg-orange-500 text-white border-orange-600":"bg-white text-gray-600 border-gray-300"),children:"あり (実施)"}),(0,s.jsx)("button",{onClick:()=>u(0),className:"flex-1 py-1 px-2 rounded text-xs border ".concat(0===g?"bg-gray-600 text-white border-gray-700":"bg-white text-gray-600 border-gray-300"),children:"なし (未実施)"})]}),(0,s.jsx)("p",{className:"text-[10px] text-orange-600 mt-1",children:"※「なし」を選択すると、項目の点数は0点になります。"})]}),"checkbox"===a.inputType?(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("button",{onClick:()=>{o(!0),i()},className:"p-3 text-left rounded border transition-colors ".concat(!0===r?"bg-blue-50 border-blue-500 text-blue-800 font-bold":"hover:bg-gray-50 border-gray-200"),children:"あり / 実施 (1点)"}),(0,s.jsx)("button",{onClick:()=>{o(!1),i()},className:"p-3 text-left rounded border transition-colors ".concat(!1===r?"bg-gray-100 border-gray-400 font-bold":"hover:bg-gray-50 border-gray-200"),children:"なし / 未実施 (0点)"}),a.description&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:a.description})]}):(0,s.jsx)("div",{className:"flex flex-col gap-2",children:null==(t=a.options)?void 0:t.map(e=>(0,s.jsxs)("button",{onClick:()=>{o(e.value,a.hasAssistance?g:void 0),i()},className:"p-3 text-left rounded border transition-colors group ".concat(r===e.value?"bg-green-50 border-green-500 ring-1 ring-green-500":"hover:bg-gray-50 border-gray-200"),children:[(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("span",{className:"font-bold ".concat(r===e.value?"text-green-800":"text-gray-700"),children:e.label})}),e.explanation&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1 group-hover:text-gray-700",children:e.explanation})]},e.value))})]}),(0,s.jsx)("div",{className:"mt-3 pt-2 border-t border-gray-100 text-right",children:(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"値を選択すると確定して閉じます"})})]})};var F=a(8770),T=a(7314),M=a(2036),z=a(3180),J=a(6615),W=a(8127),L=a(3173),R=a(1190),Y=a(3263),U=a(1288),B=a(1851),P=a(3630);let V=e=>{var t,a,r,n;let{patientId:d,patient:c,admissions:m,currentDate:g,onDateSelect:u,lastUpdated:b,onDirtyChange:h,onPatientRefresh:p}=e,y=new Date(g),j=y.getFullYear(),v=y.getMonth()+1,N="".concat(j,"-").concat(String(v).padStart(2,"0")),w=Array.from({length:new Date(j,v,0).getDate()},(e,t)=>"".concat(j,"-").concat(String(v).padStart(2,"0"),"-").concat(String(t+1).padStart(2,"0"))),[S,D]=(0,l.useState)({}),[V,G]=(0,l.useState)(m||[]),[K,H]=(0,l.useState)(c),[q,X]=(0,l.useState)(!1),[Q,Z]=(0,l.useState)("");(0,l.useEffect)(()=>{c?H(c):H(C().find(e=>e.id===d))},[d,c,b]),(0,l.useEffect)(()=>{m?G(m):G(A(d))},[d,m,b]);let $=e=>V.find(t=>{let a=t.admissionDate,s=t.dischargeDate;return e>=a&&(!s||e<=s)}),ee=e=>!!$(e),et=e=>{if(es){if(!confirm("編集中のデータは破棄されますが、移動してもよろしいですか？"))return;el(null),en({})}let t=new Date(j,v-1+e,1);u("".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0")))};(0,l.useEffect)(()=>{if(0===V.length)return void D({});let e=w[0],t=w[w.length-1],a=V.filter(a=>{let s=a.admissionDate,l=a.dischargeDate||"9999-12-31";return s<=t&&l>=e}),s={};a.forEach(e=>{let t=((e,t)=>{let a={},s="".concat(f).concat(e,"_").concat(t);for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t&&t.startsWith(s)){let e=localStorage.getItem(t);if(e){let t=JSON.parse(e);a[t.date]=t}}}return a})(e.id,N);s={...s,...t}}),D(s)},[V,N,b]);let ea=(0,l.useMemo)(()=>{let e={a:[],b:[],c:[]};return x.forEach(t=>{e[t.category]&&e[t.category].push(t)}),e},[]),[es,el]=(0,l.useState)(null),[er,en]=(0,l.useState)({}),[eo,ei]=(0,l.useState)(null),ed=Object.keys(er).length>0||!!es;(0,l.useEffect)(()=>{null==h||h(ed);let e=e=>{ed&&(e.preventDefault(),e.returnValue="")};return ed&&window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[ed,h]),(0,l.useEffect)(()=>{el(null),en({}),ei(null)},[d]);let[ec,ex]=(0,l.useState)({isOpen:!1,item:null,position:{x:0,y:0}}),em=e=>{let t=$(e);if(!t)return{ward:"-",room:"-",status:"-"};let a=t.initialWard||"-",s=t.initialRoom||"-",l="入院中";for(let r of(t.admissionDate===e&&(l="入院"),t.dischargeDate===e&&(l="退院"),(t.movements||[]).filter(t=>t.date<=e).sort((e,t)=>e.date.localeCompare(t.date))))"transfer_ward"===r.type?(r.ward&&(a=r.ward),r.room&&(s=r.room),r.date===e&&(l="転棟")):"transfer_room"===r.type?(r.room&&(s=r.room),r.date===e&&(l="転床")):"overnight"===r.type&&(r.date===e?l="外泊":r.endDate&&e>r.date&&e<=r.endDate&&(l="外泊中"));return t.dischargeDate===e&&(l="退院"),{ward:a,room:s,status:l}},eg=(0,l.useMemo)(()=>[...ea.a,...ea.b,...ea.c],[ea]),eu=(e,t)=>{let a=0,s=0,l=0;return x.forEach(t=>{let r=e[t.id];if("a"===t.category&&!0===r&&(a+=t.points),"c"===t.category&&!0===r&&(l+=t.points),"b"===t.category&&"number"==typeof r){let a=r;if(t.hasAssistance){let s=e["".concat(t.id,"_assist")];a*="number"==typeof s?s:1}s+=a}}),{items:e,scoreA:a,scoreB:s,scoreC:l}},eb=()=>{confirm("編集中の内容を破棄しますか？")&&(el(null),en({}),ei(null),ex({isOpen:!1,item:null,position:{x:0,y:0}}))},eh=()=>{let e=Object.keys(er);e.forEach(e=>{(e=>{let t=_(e.admissionId,e.date);localStorage.setItem(t,JSON.stringify(e))})(er[e])}),D(t=>{let a={...t};return e.forEach(e=>{a[e]=er[e]}),a}),el(null),en({}),ei(null)};(0,l.useEffect)(()=>{if(!es||!eo)return void ex(e=>({...e,isOpen:!1}));let e=x.find(e=>e.id===eo);if(!e)return;let t=document.querySelector('[data-cell-date="'.concat(es,'"][data-cell-item="').concat(eo,'"]'));if(t){let a=t.getBoundingClientRect(),s=a.right+10,l=a.top+window.scrollY;s+320>window.innerWidth&&(s=a.left-320-10),ex({isOpen:!0,item:e,position:{x:s,y:l}}),t.scrollIntoView({behavior:"smooth",block:"nearest"})}},[eo,es]),(0,l.useEffect)(()=>{if(!es)return;let e=e=>{if(!e.metaKey&&!e.ctrlKey){if("ArrowDown"===e.key||"Enter"===e.key||"Tab"===e.key)e.preventDefault(),ep(1);else if("ArrowUp"===e.key)e.preventDefault(),ep(-1);else if(["0","1","2"].includes(e.key)&&eo){let t=x.find(e=>e.id===eo);if(t){let a=parseInt(e.key);if(e.preventDefault(),t.options){if(t.options.find(e=>e.value===a))return void ef(t,a)}else if("checkbox"===t.inputType){1===a&&ef(t,!0),0===a&&ef(t,!1);return}}}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[es,eo,er,eg]);let ep=e=>{if(!eo)return;let t=eg.findIndex(e=>e.id===eo);if(-1===t)return;let a=t+e;a>=0&&a<eg.length&&ei(eg[a].id)},ef=(e,t)=>{ey(t,1),ep(1)},ey=(e,t)=>{if(!es||!er[es]||!eo||!x.find(e=>e.id===eo))return;let a=er[es],s={...a.items,[eo]:e};"number"==typeof t&&(s["".concat(eo,"_assist")]=t);let l=0,r=0,n=0;x.forEach(e=>{let t=s[e.id];if("a"===e.category&&!0===t&&(l+=e.points),"c"===e.category&&!0===t&&(n+=e.points),"b"===e.category&&"number"==typeof t){let a=t;if(e.hasAssistance){let t=s["".concat(e.id,"_assist")];a*="number"==typeof t?t:1}r+=a}});let o=E(a.admissionFeeId,{items:s,scoreA:l,scoreB:r,scoreC:n});en(e=>({...e,[es]:{...a,items:s,scores:{a:l,b:r,c:n},isSevere:o}}))},ej=()=>{if(es){if(!confirm("編集中のデータは破棄されますが、移動してもよろしいですか？"))return;el(null),en({})}Z((null==K?void 0:K.memo)||""),X(!0)},ev=()=>{if(!K)return;let e={...K,memo:Q};k(e),H(e),X(!1),null==p||p()};return(0,s.jsxs)("div",{className:"flex flex-col h-full bg-white relative w-full overflow-hidden rounded-lg shadow border border-gray-200",children:[(0,s.jsx)("div",{className:"shrink-0 z-40 bg-white border-b border-gray-200 shadow-sm relative",children:K&&(0,s.jsxs)("div",{className:"px-6 py-4 flex items-start justify-between gap-6 ".concat(K.excludeFromAssessment?"bg-red-50":"bg-blue-50/30"),children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-baseline gap-x-8 gap-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-4xl font-bold text-gray-900 tracking-tight",children:K.name}),K.excludeFromAssessment&&(0,s.jsxs)("span",{className:"flex items-center gap-1 bg-red-600 text-white px-3 py-1 rounded-full text-base font-bold shadow-sm animate-pulse",children:[(0,s.jsx)(F.A,{className:"w-5 h-5"})," 評価対象外"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-lg text-gray-700 mt-2",children:[(0,s.jsxs)("span",{className:"font-mono bg-white px-2 py-0.5 rounded border border-gray-300 font-bold text-gray-600 text-base",children:["ID: ",K.identifier]}),"1"===K.gender&&(0,s.jsxs)("span",{className:"flex items-center gap-1 text-blue-700 font-bold bg-blue-100 px-2 py-0.5 rounded text-base",children:[(0,s.jsx)(T.A,{className:"w-4 h-4"})," 男性"]}),"2"===K.gender&&(0,s.jsxs)("span",{className:"flex items-center gap-1 text-pink-700 font-bold bg-pink-100 px-2 py-0.5 rounded text-base",children:[(0,s.jsx)(T.A,{className:"w-4 h-4"})," 女性"]}),"1"!==K.gender&&"2"!==K.gender&&(0,s.jsxs)("span",{className:"flex items-center gap-1 text-gray-700 font-bold bg-gray-200 px-2 py-0.5 rounded text-base",children:[(0,s.jsx)(T.A,{className:"w-4 h-4"})," その他"]}),(0,s.jsxs)("span",{className:"text-base font-bold",children:[K.birthDate,"生"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-[300px] ml-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 font-bold text-orange-600 text-base cursor-pointer hover:bg-orange-50 rounded px-1 transition-colors shrink-0",onClick:ej,title:"メモを編集",children:[(0,s.jsx)(M.A,{className:"w-4 h-4"})," メモ:"]}),q?(0,s.jsxs)("div",{className:"flex-1 flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:Q,onChange:e=>Z(e.target.value),className:"flex-1 text-sm border border-orange-300 rounded px-2 py-1 focus:ring-2 focus:ring-orange-500 font-sans",autoFocus:!0,placeholder:"メモを入力...",onKeyDown:e=>{"Enter"===e.key&&ev(),"Escape"===e.key&&X(!1)}}),(0,s.jsxs)("button",{onClick:ev,className:"px-2 py-1 bg-orange-600 text-white rounded hover:bg-orange-700 text-xs font-bold whitespace-nowrap",children:[(0,s.jsx)(z.A,{className:"w-3 h-3 inline mr-1"}),"保存"]}),(0,s.jsx)("button",{onClick:()=>X(!1),className:"px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-xs font-bold whitespace-nowrap",children:(0,s.jsx)(J.A,{className:"w-3 h-3 inline"})})]}):(0,s.jsx)("span",{className:"text-gray-800 text-base bg-yellow-50 border border-yellow-200 rounded px-2 py-0.5 truncate cursor-pointer hover:bg-yellow-100 transition-colors flex-1 max-w-2xl",onClick:ej,title:K.memo||"クリックしてメモを追加",children:K.memo||(0,s.jsx)("span",{className:"text-gray-400 italic text-sm",children:"メモなし"})})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2 bg-blue-50/50 p-2 rounded-lg border border-blue-100 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 font-bold text-blue-700 text-sm whitespace-nowrap",children:[(0,s.jsx)(W.A,{className:"w-4 h-4"})," 入院歴:"]}),(0,s.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar",children:V.length>0?(0,s.jsxs)(s.Fragment,{children:[V.sort((e,t)=>t.admissionDate.localeCompare(e.admissionDate)).slice(0,3).map(e=>{let t=!e.dischargeDate||e.dischargeDate>=g;return(0,s.jsxs)("div",{onClick:()=>{if(es){if(!confirm("編集中のデータは破棄されますが、移動してもよろしいですか？"))return;el(null),en({})}let[t,a]=e.admissionDate.split("-");u("".concat(t,"-").concat(a,"-01"))},title:"入院月に移動",className:"flex items-center gap-1 px-2 py-0.5 rounded text-sm cursor-pointer transition-colors whitespace-nowrap ".concat(t?"bg-white border border-blue-300 text-blue-900 font-bold shadow-sm hover:bg-blue-50":"text-gray-500 hover:bg-gray-100"),children:[(0,s.jsx)("span",{className:"font-mono",children:e.admissionDate}),(0,s.jsx)(L.A,{className:"w-3 h-3 text-gray-400"}),(0,s.jsx)("span",{className:"font-mono",children:e.dischargeDate||"継続"})]},e.id)}),V.length>3&&(0,s.jsxs)("span",{className:"text-gray-500 text-xs font-bold",children:["+",V.length-3]})]}):(0,s.jsx)("span",{className:"text-gray-400 text-xs",children:"なし"})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-xl border-2 border-blue-600 shadow-lg self-center shrink-0 ml-4",children:[(0,s.jsx)("button",{onClick:()=>et(-1),className:"p-2 hover:bg-blue-100 text-blue-700 rounded-full transition-colors",title:"前月",children:(0,s.jsx)(R.A,{className:"w-8 h-8"})}),(0,s.jsxs)("div",{className:"text-center min-w-[110px] flex flex-col items-center justify-center",children:[(0,s.jsxs)("div",{className:"text-xl text-blue-600 font-extrabold tracking-tight leading-none mb-1",children:[j,"年"]}),(0,s.jsxs)("div",{className:"text-4xl font-black text-blue-800 leading-none tracking-normal",style:{fontFeatureSettings:'"tnum"'},children:[v,(0,s.jsx)("span",{className:"text-xl ml-1 font-bold text-blue-600",children:"月"})]})]}),(0,s.jsx)("button",{onClick:()=>et(1),className:"p-2 hover:bg-blue-100 text-blue-700 rounded-full transition-colors",title:"次月",children:(0,s.jsx)(Y.A,{className:"w-8 h-8"})})]})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-auto relative bg-gray-50/50",children:(0,s.jsx)("div",{className:"min-w-max",children:(0,s.jsxs)("table",{className:"w-full text-base text-center border-separate border-spacing-0",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 border border-gray-300 min-w-[300px] text-left bg-gray-100 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] outline outline-1 outline-gray-300",style:{position:"sticky",top:0,left:0,zIndex:60,background:"#f3f4f6"},children:"項目 / 日付"}),w.map((e,t)=>{let a=parseInt(e.split("-")[2]),l=e===g,r=e===es,n=new Date,o=e>"".concat(n.getFullYear(),"-").concat(String(n.getMonth()+1).padStart(2,"0"),"-").concat(String(n.getDate()).padStart(2,"0")),i=ee(e)&&!o&&!(null==K?void 0:K.excludeFromAssessment),d=er[e],c=S[e],x=d||c,m=null==x?void 0:x.isSevere,b=null==K?void 0:K.excludeFromAssessment;return(0,s.jsx)("th",{className:"\n                      p-2 border border-gray-300 min-w-[60px] transition-colors relative group\n                      ".concat(b?"bg-red-50":"","\n                      ").concat(r?"bg-yellow-50 border-yellow-400 border-2 border-b-0":"","\n                      ").concat(!r&&l?"bg-blue-600 text-white":"","\n                      ").concat(!r&&!l&&!b?"bg-gray-100 hover:bg-gray-200":"","\n                      ").concat(!r&&m?"bg-pink-100 text-red-800":"","\n                      ").concat(!i?"text-gray-400 cursor-not-allowed":"","\n                      ").concat(i||b?"":"bg-gray-200"," \n                    "),style:{position:"sticky",top:0,zIndex:50},onClick:()=>!r&&i&&u(e),children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1 ".concat(i?"":"opacity-50"),children:[(0,s.jsx)("span",{children:a}),r?(0,s.jsxs)("div",{className:"flex gap-1 z-50 relative items-center",children:[(0,s.jsx)("button",{onClick:eh,className:"p-1 bg-green-500 text-white rounded hover:bg-green-600",title:"保存",children:(0,s.jsx)(z.A,{className:"w-3 h-3"})}),(0,s.jsx)("button",{onClick:eb,className:"p-1 bg-gray-500 text-white rounded hover:bg-gray-600",title:"キャンセル",children:(0,s.jsx)(J.A,{className:"w-3 h-3"})})]}):(0,s.jsxs)("div",{className:"h-5 flex gap-1 items-center justify-center",children:[t>0&&!S[e]&&i&&(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{let t=$(e);if(!t)return alert("この日付は入院期間外です");let a=w.indexOf(e);if(a<=0)return alert("前日のデータがありません");let s=S[w[a-1]];if(!s){let a=((e,t)=>{let a=new Date(t);return isNaN(a.getTime())?null:(a.setDate(a.getDate()-1),((e,t)=>{let a=_(e,t),s=localStorage.getItem(a);return s?JSON.parse(s):null})(e,a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0")))})(t.id,e);a&&(s=a)}if(!s)return alert("前日のデータが登録されていません");let l=new Date;if(e>"".concat(l.getFullYear(),"-").concat(String(l.getMonth()+1).padStart(2,"0"),"-").concat(String(l.getDate()).padStart(2,"0")))return alert("未来の日付は編集できません。");if(es&&es!==e&&!confirm("他の日の編集を破棄してこの日を編集しますか？"))return;let r={...s.items},{scoreA:n,scoreB:o,scoreC:i}=eu(r,s.admissionFeeId),d={id:"".concat(e,"_").concat(t.id),admissionId:t.id,date:e,items:r,admissionFeeId:s.admissionFeeId,scores:{a:n,b:o,c:i},isSevere:E(s.admissionFeeId,{items:r,scoreA:n,scoreB:o,scoreC:i})};en({[e]:d}),el(e),eg.length>0&&ei(eg[0].id)})(e)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"前日のデータをコピーして編集",children:(0,s.jsx)(U.A,{className:"w-3 h-3"})}),i&&(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{let t=new Date;if(e>"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0")))return alert("未来の日付は編集できません。");let a=$(e);if(!a)return alert("この日付に該当する入院記録がありません。入院日を確認してください。");if(es&&es!==e&&!confirm("他の日の編集を破棄してこの日を編集しますか？"))return;let s=S[e],l=(null==s?void 0:s.admissionFeeId)||"acute_general_5",{items:r,scoreA:n,scoreB:o,scoreC:i}=eu((null==s?void 0:s.items)?{...s.items}:{},l),d={id:"".concat(e,"_").concat(a.id),admissionId:a.id,date:e,items:r,admissionFeeId:l,scores:{a:n,b:o,c:i},isSevere:E(l,{items:r,scoreA:n,scoreB:o,scoreC:i})};en({[e]:d}),el(e),eg.length>0&&ei(eg[0].id)})(e)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"編集",children:(0,s.jsx)(M.A,{className:"w-3 h-3"})})]}),!!d&&!r&&(0,s.jsx)("span",{className:"w-2 h-2 bg-red-500 rounded-full"})]})},e)})]})}),(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-2 border border-gray-300 font-bold text-gray-700 shadow-sm",style:{position:"sticky",left:0,zIndex:45,background:"#f3f4f6"},children:(0,s.jsxs)("div",{className:"flex items-center gap-2 pl-1",children:[(0,s.jsx)(i.A,{className:"w-4 h-4 text-gray-500"}),(0,s.jsx)("span",{className:"text-sm",children:"病棟"})]})}),w.map(e=>{let{ward:t}=em(e);return(0,s.jsx)("td",{className:"border border-gray-300 p-2 text-center text-xs whitespace-nowrap bg-white text-gray-600",children:t},e)})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-2 border border-gray-300 font-bold text-gray-700 shadow-sm",style:{position:"sticky",left:0,zIndex:45,background:"#f3f4f6"},children:(0,s.jsxs)("div",{className:"flex items-center gap-2 pl-1",children:[(0,s.jsx)(o.A,{className:"w-4 h-4 text-gray-500"}),(0,s.jsx)("span",{className:"text-sm",children:"病室"})]})}),w.map(e=>{let{room:t}=em(e);return(0,s.jsx)("td",{className:"border border-gray-300 p-2 text-center text-xs font-mono bg-white text-gray-600",children:"-"!==t?"".concat(t):"-"},e)})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-2 border border-gray-300 font-bold text-gray-700 shadow-sm border-b-2 border-b-gray-300",style:{position:"sticky",left:0,zIndex:45,background:"#f3f4f6"},children:(0,s.jsxs)("div",{className:"flex items-center gap-2 pl-1",children:[(0,s.jsx)(B.A,{className:"w-4 h-4 text-gray-500"}),(0,s.jsx)("span",{className:"text-sm",children:"状況"})]})}),w.map(e=>{let{status:t}=em(e),a="text-gray-400",l="bg-white";return"入院"===t&&(a="text-blue-600 font-bold",l="bg-blue-50"),"退院"===t&&(a="text-red-600 font-bold",l="bg-red-50"),t.includes("転")&&(a="text-orange-600 font-bold",l="bg-orange-50"),t.includes("外泊")&&(a="text-purple-600 font-bold",l="bg-purple-50"),(0,s.jsx)("td",{className:"border border-gray-300 border-b-2 border-b-gray-300 p-2 text-center text-xs whitespace-nowrap ".concat(l," ").concat(a),children:t},e)})]}),(()=>{let e=e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-2 border border-gray-300 text-left bg-white truncate max-w-[300px] shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] outline outline-1 outline-gray-300",title:e.label,style:{position:"sticky",left:0,zIndex:40,background:"white"},children:e.label}),w.map((t,a)=>{var l,r,n,o,i,d,c,x,m;let b=t===es,h=ee(t),p=new Date,f=t>"".concat(p.getFullYear(),"-").concat(String(p.getMonth()+1).padStart(2,"0"),"-").concat(String(p.getDate()).padStart(2,"0")),y=h&&!f&&!(null==K?void 0:K.excludeFromAssessment),j=er[t],v=S[t],N=j||v,w=null==N||null==(l=N.items)?void 0:l[e.id],k="";"checkbox"===e.inputType?!0===w&&(k=(0,s.jsx)("span",{className:"text-blue-600 font-bold",children:"●"})):"number"==typeof w&&(k=w);let D=!1;if(j){let t="checkbox"!==e.inputType&&0;(null!=(o=null==(r=j.items)?void 0:r[e.id])?o:t)!==(null!=(i=null==v||null==(n=v.items)?void 0:n[e.id])?i:t)&&(D=!0),!D&&"b"===e.category&&e.hasAssistance&&(null!=(x=null==(d=j.items)?void 0:d["".concat(e.id,"_assist")])?x:1)!==(null!=(m=null==v||null==(c=v.items)?void 0:c["".concat(e.id,"_assist")])?m:1)&&(D=!0)}let C=b&&eo===e.id;return(0,s.jsxs)("td",{"data-cell-date":t,"data-cell-item":e.id,className:"\n                            border border-gray-300 relative\n                            ".concat(b?"cursor-pointer":"","\n                            ").concat(b&&!C?"bg-white hover:bg-yellow-50":"","\n                            ").concat(C?"bg-yellow-200 outline outline-2 outline-blue-500 z-10":""," \n                            ").concat(b?"border-yellow-400 border-x-2":"","\n                            ").concat(!b&&(null==N?void 0:N.isSevere)?"bg-pink-50":"","\n                            ").concat(y||b?"":"bg-gray-100","\n                          "),onClick:a=>b&&((e,t,a)=>{if(es!==t){t!==g&&u(t);return}ei(a.id)})(0,t,e),children:[k,D&&(0,s.jsx)("span",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"})]},t)})]},e.id),t=(e,t,a)=>(0,s.jsxs)("tr",{className:"".concat(a," font-bold"),children:[(0,s.jsx)("td",{className:"".concat(a," p-2 border shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]"),style:{position:"sticky",left:0,zIndex:40},children:e}),w.map((e,a)=>{var l,r;let n=er[e],o=S[e],i=n||o,d=e===es;return(0,s.jsx)("td",{className:"border ".concat(d?"bg-yellow-50 border-yellow-400 border-x-2":""," ").concat(!d&&(null==i?void 0:i.isSevere)?"bg-pink-50":""),children:null!=(r=null==i||null==(l=i.scores)?void 0:l[t])?r:"-"},e)})]});return(0,s.jsxs)(s.Fragment,{children:[t("A項目 (得点)","a","bg-blue-50"),ea.a.map(e),t("B項目 (得点)","b","bg-green-50"),ea.b.map(e),t("C項目 (得点)","c","bg-gray-100"),ea.c.map(e)]})})(),(0,s.jsxs)("tr",{className:"bg-gray-800 text-white font-bold",children:[(0,s.jsx)("td",{className:"p-2 border border-gray-600 text-left bg-gray-800 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] outline outline-1 outline-gray-600",style:{position:"sticky",left:0,zIndex:40,background:"#1f2937",color:"white"},children:"判定結果"}),w.map((e,t)=>{let a=er[e],l=S[e],r=a||l;return r?e===es?(0,s.jsx)("td",{className:"border border-gray-600 bg-gray-700",children:(0,s.jsx)("button",{onClick:()=>(e=>{if(!confirm("".concat(e," のデータを削除しますか？")))return;let t=$(e);if(t)I(t.id,e);else{let t=S[e];t&&t.admissionId&&I(t.admissionId,e)}D(t=>{let a={...t};return delete a[e],a}),es===e&&eb()})(e),className:"text-red-400 hover:text-red-200 p-1",title:"データを削除",children:(0,s.jsx)(P.A,{className:"w-4 h-4"})})},e):(0,s.jsx)("td",{className:"border border-gray-600 ".concat(r.isSevere?"bg-red-600":"bg-gray-700"),children:r.isSevere?"○":"\xd7"},e):(0,s.jsx)("td",{className:"border border-gray-600 bg-gray-100"},e)})]})]})]})})}),ec.isOpen&&ec.item&&er[es]&&(0,s.jsx)(O,{item:ec.item,currentValue:null==(a=er[es])||null==(t=a.items)?void 0:t[ec.item.id],currentAssistValue:null==(n=er[es])||null==(r=n.items)?void 0:r["".concat(ec.item.id,"_assist")],onSave:ey,onClose:()=>ex(e=>({...e,isOpen:!1})),position:ec.position})]})},G=()=>{let[e,t]=(0,l.useState)([]),[a,r]=(0,l.useState)({}),[n,o]=(0,l.useState)(""),[i,d]=(0,l.useState)(""),[c,x]=(0,l.useState)(256),[m,p]=(0,l.useState)(!1),[f,v]=(0,l.useState)(0),[N,w]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=e=>{m&&x(Math.max(200,Math.min(600,e.clientX)))},t=()=>p(!1);return m&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[m]),(0,l.useEffect)(()=>{let e=new Date;d("".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0"))),(()=>{let e=localStorage.getItem(g);if(e)return JSON.parse(e);{let{patients:e,admissions:t}=(()=>{let e=[],t=[],a=["佐藤","鈴木","高橋","田中","伊藤","渡辺","山本","中村","小林","加藤"],s=["健太","大輔","誠","直人","翔太","浩之","剛","一郎","進","明"],l=["美咲","愛","陽子","裕子","恵子","香織","真由美","直子","千尋","彩"];for(let r=1;r<=60;r++){let n=String(r).padStart(3,"0"),o=r%2==0,i=a[r%10],d=o?l[r%10]:s[r%10],c="".concat(i," ").concat(d),x=1940+r%50,m=String(r%12+1).padStart(2,"0"),g=String(r%28+1).padStart(2,"0"),u="".concat(x,"-").concat(m,"-").concat(g),b=String((r+3)%12+1).padStart(2,"0"),h=String((r+5)%28+1).padStart(2,"0"),p="2024-".concat(b,"-").concat(h),f=y[r%y.length].name;!function(a,s,l,r,n,o){let i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9?arguments[9]:void 0,m="p".concat(a);e.push({id:m,identifier:"100".concat(a),name:s,gender:l,birthDate:r,postalCode:"100-0001",address:"東京都千代田区千代田1-1",memo:d?"入退院を繰り返しています":i?"退院済み":"",excludeFromAssessment:c}),d&&t.push({id:"adm".concat(a,"_past"),patientId:m,admissionDate:"2023-01-10",dischargeDate:"2023-02-15",initialWard:"一般病棟（東）",initialRoom:"201"}),t.push({id:"adm".concat(a),patientId:m,admissionDate:n,dischargeDate:i?"2024-05-20":void 0,initialWard:x,initialRoom:o})}(n,c,o?"2":"1",u,p,j[r%j.length].name,r%5==0,r%7==0,r%8==0,f)}return{patients:e,admissions:t}})();return localStorage.setItem(g,JSON.stringify(e)),localStorage.setItem(u,JSON.stringify(t)),localStorage.getItem(b)||localStorage.setItem(b,JSON.stringify(y)),localStorage.getItem(h)||localStorage.setItem(h,JSON.stringify(j))}})();let a=C();t(a);let s={};a.forEach(e=>{s[e.id]=A(e.id)}),r(s),a.length>0&&o(a[0].id)},[]),(0,s.jsxs)("div",{className:"flex flex-1 h-full overflow-hidden bg-gray-100 relative",children:[(0,s.jsxs)("div",{className:"bg-white border-r border-gray-200 flex flex-col shrink-0 relative group",style:{width:c},children:[(0,s.jsx)("div",{className:"absolute right-0 top-0 h-full w-4 cursor-col-resize z-50 flex flex-col justify-start pt-32 items-center -mr-2 select-none",onMouseDown:e=>{e.preventDefault(),p(!0)},children:(0,s.jsx)("div",{className:"w-1.5 h-16 bg-gray-300 rounded-full transition-colors hover:bg-gray-500 shadow-sm"})}),(0,s.jsx)("div",{className:"p-4 border-b border-gray-200 bg-blue-50",children:(0,s.jsxs)("h1",{className:"text-lg font-bold text-blue-800 flex items-center gap-2",children:[(0,s.jsx)(T.A,{className:"w-5 h-5"})," 患者一覧"]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:e.map(e=>{let t=(a[e.id]||[]).sort((e,t)=>t.admissionDate.localeCompare(e.admissionDate))[0],l=t&&(!t.dischargeDate||t.dischargeDate>=i),r=t?"".concat(t.admissionDate," 入院"):"未入院";return(0,s.jsxs)("button",{onClick:()=>(e=>{n!==e&&(!N||confirm("編集中のデータがあります。破棄して別の患者へ移動しますか？"))&&(o(e),w(!1))})(e.id),className:"w-full text-left p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors ".concat(n===e.id?"bg-blue-100 border-l-4 border-l-blue-600":""),children:[(0,s.jsxs)("div",{className:"font-bold text-gray-800",children:[e.name," ",(0,s.jsxs)("span",{className:"text-xs font-normal text-gray-500",children:["(",e.identifier,")"]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["1"===e.gender?"男性":"女性"," / ",e.birthDate,"生 / ",(0,s.jsx)("span",{className:l?"text-blue-600 font-bold":"",children:r})]})]},e.id)})}),(0,s.jsx)("div",{className:"p-4 border-t border-gray-200 text-xs text-gray-400 text-center",children:"Nursing Assessment System v1.1"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-4 flex flex-col gap-4",children:n&&i&&(0,s.jsx)("section",{className:"w-full min-w-0",children:(0,s.jsx)(V,{patientId:n,currentDate:i,onDateSelect:d,lastUpdated:f,onDirtyChange:w})})})]})};var K=a(4374),H=a(406);let q=()=>(0,s.jsxs)("div",{className:"p-8 h-full bg-gray-50 overflow-y-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"ダッシュボード (当月統計)"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,s.jsx)(X,{title:"入院患者数",value:"42",subtext:"前月比 +3",icon:n.A,color:"blue"}),(0,s.jsx)(X,{title:"重症度該当率",value:"38%",subtext:"目標: 35%以上",icon:B.A,color:"green"}),(0,s.jsx)(X,{title:"A項目 2点以上",value:"15",subtext:"平均推移: 横ばい",icon:K.A,color:"purple"}),(0,s.jsx)(X,{title:"未評価アラート",value:"2",subtext:"要確認",icon:H.A,color:"red"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 h-64 flex items-center justify-center text-gray-400",children:"[重症度推移グラフ エリア]"}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 h-64 flex items-center justify-center text-gray-400",children:"[病棟別訳あり患者分布 エリア]"})]})]}),X=e=>{let{title:t,value:a,subtext:l,icon:r,color:n}=e;return(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500",children:t}),(0,s.jsx)("h3",{className:"text-3xl font-bold text-gray-800 mt-1",children:a})]}),(0,s.jsx)("div",{className:"p-3 rounded-full ".concat({blue:"bg-blue-100 text-blue-600",green:"bg-green-100 text-green-600",purple:"bg-purple-100 text-purple-600",red:"bg-red-100 text-red-600"}[n]),children:(0,s.jsx)(r,{className:"w-6 h-6"})})]}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:l})]})},Q=()=>(0,s.jsxs)("div",{className:"p-8 h-full bg-gray-50 flex flex-col items-center justify-center text-gray-400",children:[(0,s.jsx)("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:(0,s.jsx)(o.A,{className:"w-12 h-12"})}),(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-600",children:"病棟・病室管理"}),(0,s.jsx)("p",{className:"mt-2",children:"この機能は現在開発中です (Phase 2)"})]});var Z=a(2265),$=a(109),ee=a(3403),et=a(6204),ea=a(5225);let es=e=>{let{initialPatient:t,initialAdmissions:a=[],onSave:r,onCancel:n}=e,o=v(),i=N(),d=new Date().toISOString().split("T")[0],c=e=>(!e.startDate||!(e.startDate>d))&&(!e.endDate||!(e.endDate<d)),[x,m]=(0,l.useState)((null==t?void 0:t.identifier)||""),[g,u]=(0,l.useState)((null==t?void 0:t.name)||""),[b,h]=(0,l.useState)((null==t?void 0:t.gender)||"1"),[p,f]=(0,l.useState)((null==t?void 0:t.birthDate)||""),[y,j]=(0,l.useState)((null==t?void 0:t.postalCode)||""),[w,S]=(0,l.useState)((null==t?void 0:t.address)||""),[k,D]=(0,l.useState)((null==t?void 0:t.memo)||""),[C,A]=(0,l.useState)((null==t?void 0:t.excludeFromAssessment)||!1),[_,I]=(0,l.useState)(a),[E,O]=(0,l.useState)(!1),F=x&&g&&p,M=async()=>{if(!y||y.length<7)return void alert("7桁の郵便番号を入力してください");O(!0);try{let e=await fetch("https://zipcloud.ibsnet.co.jp/api/search?zipcode=".concat(y)),t=await e.json();if(t.results){let e=t.results[0],a="".concat(e.address1).concat(e.address2).concat(e.address3);S(a)}else alert("住所が見つかりませんでした")}catch(e){console.error(e),alert("住所検索に失敗しました")}finally{O(!1)}},J=(e,t,a)=>{I(_.map(s=>s.id===e?{...s,[t]:a}:s))},W=(e,t,a,s)=>{I(_.map(l=>{if(l.id!==e)return l;let r=(l.movements||[]).map(e=>e.id===t?{...e,[a]:s}:e);return{...l,movements:r}}))};return(0,s.jsxs)("div",{className:"flex flex-col h-full bg-gray-50 text-lg",children:[(0,s.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center shrink-0 shadow-sm",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:(null==t?void 0:t.id)?"患者情報の編集":"新規患者登録"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:n,className:"px-6 py-2 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-100 font-bold",children:"キャンセル"}),(0,s.jsxs)("button",{onClick:()=>{if(!F)return;let e={id:(null==t?void 0:t.id)||"",identifier:x,name:g,gender:b,birthDate:p,postalCode:y,address:w,memo:k,excludeFromAssessment:C};r(e,_)},disabled:!F,className:"px-6 py-2 rounded-lg text-white font-bold flex items-center gap-2\n                    ".concat(F?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 cursor-not-allowed","\n                "),children:[(0,s.jsx)(z.A,{className:"w-5 h-5"})," 保存する"]})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto p-8",children:(0,s.jsxs)("div",{className:"max-w-5xl mx-auto space-y-8",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-6 flex items-center gap-2 border-b pb-4",children:[(0,s.jsx)(T.A,{className:"w-6 h-6 text-gray-500"})," 基本情報"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-2",children:["患者ID ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:x,onChange:e=>m(e.target.value),className:"w-full px-4 py-3 text-xl border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-mono",placeholder:"例: 10001"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-2",children:["氏名 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:g,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 text-xl border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"例: 山田 太郎"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-2",children:"性別"}),(0,s.jsx)("div",{className:"flex bg-gray-100 rounded-lg p-1 w-fit",children:[{val:"1",label:"男性"},{val:"2",label:"女性"},{val:"3",label:"その他"}].map(e=>(0,s.jsx)("button",{onClick:()=>h(e.val),className:"px-6 py-2 rounded-md font-bold transition-all ".concat(b===e.val?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"),children:e.label},e.val))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-2",children:["生年月日 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"date",value:p,onChange:e=>f(e.target.value),className:"w-full px-4 py-3 text-xl border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,s.jsx)("div",{className:"md:col-span-2 border-t border-gray-100 my-2"}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-2",children:"評価対象区分"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("button",{onClick:()=>A(!1),className:"flex-1 py-4 px-6 rounded-lg border-2 font-bold flex items-center justify-center gap-3 transition-all\n                                    ".concat(C?"border-gray-200 text-gray-400 hover:border-gray-300":"border-blue-500 bg-blue-50 text-blue-700","\n                                "),children:[(0,s.jsx)(B.A,{className:"w-5 h-5"})," 評価対象"]}),(0,s.jsxs)("button",{onClick:()=>A(!0),className:"flex-1 py-4 px-6 rounded-lg border-2 font-bold flex items-center justify-center gap-3 transition-all\n                                    ".concat(C?"border-red-500 bg-red-50 text-red-700":"border-gray-200 text-gray-400 hover:border-gray-300","\n                                "),children:[(0,s.jsx)(ee.A,{className:"w-5 h-5"})," 評価対象外"]})]}),C&&(0,s.jsx)("p",{className:"mt-2 text-red-600 text-sm font-bold pl-1",children:"※ この患者は看護必要度評価の対象から除外されます（集計に含まれません）。"})]}),(0,s.jsx)("div",{className:"md:col-span-2 border-t border-gray-100 my-2"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-2",children:"郵便番号"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:y,onChange:e=>j(e.target.value),className:"w-full px-4 py-3 text-xl border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-mono",placeholder:"1000001",maxLength:8}),(0,s.jsx)("button",{onClick:M,disabled:E,className:"bg-gray-800 text-white px-4 py-2 rounded-lg font-bold hover:bg-gray-700 whitespace-nowrap shadow-sm",children:E?"...":"住所検索"})]})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-2",children:"住所"}),(0,s.jsx)("input",{type:"text",value:w,onChange:e=>S(e.target.value),className:"w-full px-4 py-3 text-xl border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"東京都千代田区..."})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-2",children:"メモ"}),(0,s.jsx)("input",{type:"text",value:k,onChange:e=>D(e.target.value),className:"w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"特記事項があれば入力してください"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6 border-b pb-4",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[(0,s.jsx)(B.A,{className:"w-6 h-6 text-gray-500"})," 入院歴"]}),(0,s.jsxs)("button",{onClick:()=>{I([..._,{id:"temp_".concat(Date.now()),patientId:(null==t?void 0:t.id)||"",admissionDate:new Date().toISOString().split("T")[0],initialWard:"一般病棟",initialRoom:""}])},className:"text-blue-600 font-bold hover:bg-blue-50 px-3 py-1 rounded transition-colors flex items-center gap-1",children:[(0,s.jsx)(Z.A,{className:"w-5 h-5"})," 入院追加"]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[0===_.length&&(0,s.jsx)("div",{className:"text-center py-8 text-gray-400 bg-gray-50 rounded-lg border border-dashed border-gray-300",children:"入院履歴がありません"}),_.map((e,t)=>(0,s.jsxs)("div",{className:"p-6 bg-white rounded-lg border border-gray-300 shadow-sm relative group",children:[(0,s.jsx)("button",{onClick:()=>{var t;return t=e.id,void I(_.filter(e=>e.id!==t))},className:"absolute top-4 right-4 text-gray-400 hover:text-red-600 transition-colors p-2 z-10",title:"この入院記録を削除",children:(0,s.jsx)(P.A,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["入院日 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"date",value:e.admissionDate,onChange:t=>J(e.id,"admissionDate",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"入院時病棟"}),(0,s.jsxs)("select",{value:e.initialWard||"",onChange:t=>J(e.id,"initialWard",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none bg-white",children:[(0,s.jsx)("option",{value:"",children:"選択..."}),o.filter(t=>c(t)||t.name===e.initialWard).map(e=>(0,s.jsx)("option",{value:e.name,children:e.name},e.code))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"入院時病室"}),(0,s.jsxs)("select",{value:e.initialRoom||"",onChange:t=>J(e.id,"initialRoom",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none bg-white",children:[(0,s.jsx)("option",{value:"",children:"選択..."}),i.filter(t=>c(t)||t.name===e.initialRoom).map(e=>(0,s.jsxs)("option",{value:e.name,children:[e.name,"号室"]},e.code))]})]})]}),(0,s.jsxs)("div",{className:"border-t border-b border-gray-100 py-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,s.jsxs)("h4",{className:"font-bold text-gray-700 flex items-center gap-2 text-sm",children:[(0,s.jsx)(B.A,{className:"w-4 h-4 text-blue-500"})," 異動・外泊履歴"]}),(0,s.jsxs)("button",{onClick:()=>(e=>{let t={id:"mov_".concat(Date.now(),"_").concat(Math.random()),type:"transfer_ward",date:new Date().toISOString().split("T")[0]};I(_.map(a=>{if(a.id!==e)return a;let s=a.movements||[];return{...a,movements:[...s,t]}}))})(e.id),className:"text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 px-3 py-1.5 rounded font-bold transition-colors flex items-center gap-1",children:[(0,s.jsx)(Z.A,{className:"w-3 h-3"})," 追加"]})]}),(0,s.jsx)("div",{className:"space-y-3",children:e.movements&&e.movements.length>0?e.movements.sort((e,t)=>e.date.localeCompare(t.date)).map((t,a)=>(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-end bg-gray-50/50 p-3 rounded border border-gray-200",children:[(0,s.jsxs)("div",{className:"col-span-3",children:[(0,s.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"区分"}),(0,s.jsxs)("select",{value:t.type,onChange:a=>W(e.id,t.id,"type",a.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded bg-white",children:[(0,s.jsx)("option",{value:"transfer_ward",children:"転棟"}),(0,s.jsx)("option",{value:"transfer_room",children:"転床"}),(0,s.jsx)("option",{value:"overnight",children:"外泊"})]})]}),(0,s.jsxs)("div",{className:"col-span-3",children:[(0,s.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"overnight"===t.type?"開始日":"異動日"}),(0,s.jsx)("input",{type:"date",value:t.date,onChange:a=>W(e.id,t.id,"date",a.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded"})]}),(0,s.jsxs)("div",{className:"col-span-5 grid grid-cols-2 gap-2",children:[t.type.startsWith("transfer")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"移動先病棟"}),(0,s.jsxs)("select",{value:t.ward||"",onChange:a=>W(e.id,t.id,"ward",a.target.value),disabled:"transfer_room"===t.type,className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded bg-white ".concat("transfer_room"===t.type?"bg-gray-100 text-gray-400":""),children:[(0,s.jsx)("option",{value:"",children:"(変更なし)"}),o.filter(e=>c(e)||e.name===t.ward).map(e=>(0,s.jsx)("option",{value:e.name,children:e.name},e.code))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"移動先病室"}),(0,s.jsxs)("select",{value:t.room||"",onChange:a=>W(e.id,t.id,"room",a.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded bg-white",children:[(0,s.jsx)("option",{value:"",children:"選択..."}),i.filter(e=>c(e)||e.name===t.room).map(e=>(0,s.jsxs)("option",{value:e.name,children:[e.name,"号室"]},e.code))]})]})]}),"overnight"===t.type&&(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"終了日 (任意)"}),(0,s.jsx)("input",{type:"date",value:t.endDate||"",onChange:a=>W(e.id,t.id,"endDate",a.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded"})]})]}),(0,s.jsx)("div",{className:"col-span-1 flex justify-end pb-1",children:(0,s.jsx)("button",{onClick:()=>{var a,s;return a=e.id,s=t.id,void I(_.map(e=>e.id!==a?e:{...e,movements:(e.movements||[]).filter(e=>e.id!==s)}))},className:"text-gray-400 hover:text-red-500 p-1 rounded hover:bg-red-50 transition-colors",title:"履歴を削除",children:(0,s.jsx)(P.A,{className:"w-4 h-4"})})})]},t.id)):(0,s.jsx)("div",{className:"text-sm text-gray-400 italic py-2 pl-2 border-l-4 border-gray-200 bg-gray-50",children:"・ 履歴はありません"})})]}),(0,s.jsxs)("div",{className:"max-w-xs",children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"退院日"}),(0,s.jsx)("input",{type:"date",value:e.dischargeDate||"",onChange:t=>J(e.id,"dischargeDate",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"未定/入院中"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1 ml-1",children:"※ 空欄の場合は入院中として扱われます"})]})]})]},e.id))]})]})]})})]})},el=e=>{let{patient:t,admissions:a,onBack:r,onUpdate:n,onEditingChange:o}=e,[i,d]=(0,l.useState)("basic"),[c,x]=(0,l.useState)(new Date().toISOString().split("T")[0]),[m,g]=(0,l.useState)(!1),[u,b]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=m||u;return null==o||o(e),()=>null==o?void 0:o(!1)},[m,u,o]);let h=e=>{if(i!==e){if(m||u){if(!confirm("編集中の変更は破棄されますが、移動してもよろしいですか？"))return;g(!1),b(!1)}d(e)}};return m?(0,s.jsx)(es,{initialPatient:t,initialAdmissions:a,onSave:(e,t)=>{k(e),D(e.id,t),g(!1),n&&n()},onCancel:()=>g(!1)}):(0,s.jsxs)("div",{className:"flex flex-col h-full bg-gray-50 text-lg",children:[" ",(0,s.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-4 flex items-center gap-4 shrink-0 shadow-sm",children:[r&&(0,s.jsx)("button",{onClick:r,className:"p-3 hover:bg-gray-100 rounded-full transition-colors",children:(0,s.jsx)(et.A,{className:"w-6 h-6 text-gray-600"})}),(0,s.jsx)("div",{children:(0,s.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[t.name,(0,s.jsxs)("span",{className:"text-lg font-normal text-gray-500",children:["(",t.identifier,")"]}),t.excludeFromAssessment&&(0,s.jsx)("span",{className:"bg-red-100 text-red-700 text-sm px-3 py-1 rounded-full font-bold",children:"評価対象外"})]})})]}),(0,s.jsxs)("div",{className:"px-6 pt-4 flex gap-2 border-b border-gray-200 shrink-0",children:[(0,s.jsxs)("button",{onClick:()=>h("basic"),className:"px-6 py-3 text-lg font-bold rounded-t-lg flex items-center gap-2 border-t border-l border-r border-transparent\n              ".concat("basic"===i?"bg-white text-blue-600 border-gray-200 border-b-white translate-y-[1px]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100","\n            "),children:[(0,s.jsx)(T.A,{className:"w-5 h-5"})," 基本情報・入院歴"]}),(0,s.jsxs)("button",{onClick:()=>h("matrix"),className:"px-6 py-3 text-lg font-bold rounded-t-lg flex items-center gap-2 border-t border-l border-r border-transparent\n              ".concat("matrix"===i?"bg-white text-blue-600 border-gray-200 border-b-white translate-y-[1px]":"text-gray-500 hover:text-gray-700 hover:bg-gray-100","\n            "),children:[(0,s.jsx)(B.A,{className:"w-5 h-5"})," 看護必要度評価カレンダー"]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-auto p-8",children:["basic"===i&&(0,s.jsxs)("div",{className:"max-w-5xl mx-auto space-y-8",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[(0,s.jsx)(ea.A,{className:"w-6 h-6"})," 患者基本情報"]}),(0,s.jsx)("button",{onClick:()=>g(!0),className:"text-blue-600 font-bold hover:underline text-lg",children:"編集する"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-1",children:"患者ID"}),(0,s.jsx)("p",{className:"font-mono text-xl text-gray-800",children:t.identifier})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-1",children:"氏名"}),(0,s.jsx)("p",{className:"text-xl text-gray-800",children:t.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-1",children:"性別"}),(0,s.jsx)("p",{className:"text-xl text-gray-800",children:"1"===t.gender?"男性":"2"===t.gender?"女性":"その他"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-1",children:"生年月日"}),(0,s.jsx)("p",{className:"text-xl text-gray-800",children:t.birthDate})]}),(0,s.jsx)("div",{className:"col-span-2 border-t border-gray-100 my-2"}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-1",children:"評価対象区分"}),(0,s.jsx)("div",{className:"mt-1",children:t.excludeFromAssessment?(0,s.jsxs)("span",{className:"flex items-center gap-2 text-red-600 font-bold text-xl",children:[(0,s.jsx)(ee.A,{className:"w-5 h-5 fill-red-100"})," 評価対象外"]}):(0,s.jsx)("span",{className:"text-xl text-gray-800",children:"評価対象"})})]}),(0,s.jsx)("div",{className:"col-span-2 border-t border-gray-100 my-2"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-1",children:"郵便番号"}),(0,s.jsx)("p",{className:"text-xl text-gray-800 font-mono",children:t.postalCode||"-"})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-1",children:"住所"}),(0,s.jsx)("p",{className:"text-xl text-gray-800",children:t.address||"-"})]}),(0,s.jsx)("div",{className:"col-span-2 border-t border-gray-100 my-2"}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 uppercase mb-1",children:"患者メモ"}),(0,s.jsx)("p",{className:"text-xl text-gray-800 whitespace-pre-wrap leading-relaxed",children:t.memo||"特記事項なし"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[(0,s.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,s.jsxs)("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[(0,s.jsx)(B.A,{className:"w-6 h-6"})," 入院歴"]})}),a.length>0?(0,s.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,s.jsxs)("div",{className:"p-6 bg-gray-50 rounded-lg border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-2 mb-2",children:[(0,s.jsxs)("div",{className:"text-xl font-bold text-gray-800 font-mono",children:[e.admissionDate," ",(0,s.jsx)("span",{className:"text-gray-400 mx-2",children:"〜"})," ",e.dischargeDate||"継続中"]}),!e.dischargeDate&&(0,s.jsx)("span",{className:"bg-green-100 text-green-700 font-bold px-3 py-1 rounded text-base inline-block text-center",children:"入院中"})]}),(0,s.jsxs)("div",{className:"text-lg text-gray-600",children:["入院時病棟: ",(0,s.jsx)("span",{className:"font-semibold",children:e.initialWard||"-"})," / ",(0,s.jsx)("span",{className:"font-semibold",children:e.initialRoom||"-"}),"号室"]})]},e.id))}):(0,s.jsx)("p",{className:"text-gray-400 text-lg",children:"入院歴はありません"})]})]}),"matrix"===i&&(0,s.jsx)("div",{className:"h-full bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,s.jsx)(V,{patientId:t.id,patient:t,admissions:a,currentDate:c,onDateSelect:x,onDirtyChange:b,onPatientRefresh:n})})]})]})},er=e=>{let{onEditingChange:t}=e,[a,r]=(0,l.useState)([]),[o,i]=(0,l.useState)({}),[d,c]=(0,l.useState)(null),[x,m]=(0,l.useState)(""),[g,u]=(0,l.useState)(""),[b,h]=(0,l.useState)(""),[p,f]=(0,l.useState)(""),[y,j]=(0,l.useState)(!1),[v,N]=(0,l.useState)(!1),[w,S]=(0,l.useState)(null);(0,l.useEffect)(()=>(null==t||t(v),()=>null==t?void 0:t(!1)),[v,t]);let[_,I]=(0,l.useState)(1);(0,l.useEffect)(()=>{let e=C();r(e);let t={};e.forEach(e=>{t[e.id]=A(e.id)}),i(t)},[]);let E=(0,l.useMemo)(()=>a.filter(e=>!!(e.name.includes(x)||e.identifier&&e.identifier.includes(x))&&(!g||e.birthDate===g)&&(!b&&!p||!!(o[e.id]||[]).some(e=>{let t=e.admissionDate,a=e.dischargeDate||"9999-12-31",s=b||"0000-01-01";return t<=(p||"9999-12-31")&&a>=s}))&&(!y||!!e.excludeFromAssessment)).sort((e,t)=>t.id.localeCompare(e.id)),[a,x,g,b,p,y,o]),O=Math.ceil(E.length/20),F=(0,l.useMemo)(()=>{let e=(_-1)*20;return E.slice(e,e+20)},[_,E]),T=(e,t)=>{e(t),I(1)};return v&&w?(0,s.jsx)(es,{initialPatient:w,onSave:(e,t)=>{k(e),D(e.id,t),r(C());let a={};C().forEach(e=>{a[e.id]=A(e.id)}),i(a),N(!1),S(null)},onCancel:()=>{N(!1),S(null)}}):d?(0,s.jsx)(el,{patient:d,admissions:o[d.id]||[],onEditingChange:t,onBack:()=>c(null),onUpdate:()=>{let e=C();r(e);let t=e.find(e=>e.id===d.id);t&&c(t);let a={};e.forEach(e=>{a[e.id]=A(e.id)}),i(a)}}):(0,s.jsxs)("div",{className:"flex flex-col h-full bg-gray-50 text-lg",children:[(0,s.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center shrink-0",children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[(0,s.jsx)(n.A,{className:"w-8 h-8 text-blue-600"}),"患者管理"]}),(0,s.jsxs)("button",{onClick:()=>{let e=C(),t=0;e.forEach(e=>{let a=parseInt(e.identifier,10);!isNaN(a)&&a>t&&(t=a)}),S({id:"",identifier:String(t+1).padStart(5,"0"),name:"",gender:"1",birthDate:"",postalCode:"",address:"",memo:"",excludeFromAssessment:!1}),N(!0)},className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 shadow-sm transition-colors flex items-center gap-2 font-bold text-lg",children:[(0,s.jsx)(Z.A,{className:"w-5 h-5"})," 新規患者登録"]})]}),(0,s.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-4 flex flex-wrap gap-4 items-end shrink-0 shadow-sm",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"キーワード検索"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)($.A,{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"氏名・ID...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md w-64 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg",value:x,onChange:e=>T(m,e.target.value)})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"生年月日"}),(0,s.jsx)("input",{type:"date",className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg",value:g,onChange:e=>T(u,e.target.value)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"入院期間 (開始)"}),(0,s.jsx)("input",{type:"date",className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg",value:b,onChange:e=>T(h,e.target.value)})]}),(0,s.jsx)("span",{className:"text-gray-400 mt-8",children:"〜"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"入院期間 (終了)"}),(0,s.jsx)("input",{type:"date",className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg",value:p,onChange:e=>T(f,e.target.value)})]})]}),(0,s.jsx)("div",{className:"pb-3 pl-4",children:(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500",checked:y,onChange:e=>T(j,e.target.checked)}),(0,s.jsx)("span",{className:"text-lg font-bold text-gray-700",children:"評価対象外のみ"})]})})]}),(0,s.jsx)("div",{className:"p-6 flex-1 overflow-auto",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,s.jsxs)("table",{className:"w-full text-left",children:[(0,s.jsx)("thead",{className:"bg-gray-50 text-gray-600 font-bold border-b border-gray-200 text-lg",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-4 whitespace-nowrap text-center",children:"患者ID"}),(0,s.jsx)("th",{className:"px-6 py-4 whitespace-nowrap text-center",children:"氏名"}),(0,s.jsx)("th",{className:"px-6 py-4 whitespace-nowrap text-center",children:"性別"}),(0,s.jsx)("th",{className:"px-6 py-4 whitespace-nowrap text-center",children:"生年月日"}),(0,s.jsx)("th",{className:"px-6 py-4 whitespace-nowrap text-center",children:"対象外"}),(0,s.jsx)("th",{className:"px-6 py-4 whitespace-nowrap text-center",children:"メモ"}),(0,s.jsx)("th",{className:"px-6 py-4 min-w-[300px]",children:"最新の入院歴"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-100",children:[F.map(e=>{let t=(o[e.id]||[]).sort((e,t)=>t.admissionDate.localeCompare(e.admissionDate))[0],a=t?"".concat(t.admissionDate," 〜 ").concat(t.dischargeDate||"入院中"):"記録なし";return(0,s.jsxs)("tr",{onClick:()=>c(e),className:"hover:bg-blue-50 transition-colors cursor-pointer group text-xl",children:[(0,s.jsx)("td",{className:"px-6 py-4 font-mono text-gray-600 text-center",children:e.identifier}),(0,s.jsx)("td",{className:"px-6 py-4 font-bold text-gray-800 text-center",children:e.name}),(0,s.jsx)("td",{className:"px-6 py-4 text-gray-600 text-center",children:"1"===e.gender?"男性":"2"===e.gender?"女性":"その他"}),(0,s.jsx)("td",{className:"px-6 py-4 text-gray-600 font-mono text-center",children:e.birthDate}),(0,s.jsx)("td",{className:"px-6 py-4 text-center",children:e.excludeFromAssessment&&(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(ee.A,{className:"w-6 h-6 text-red-500 fill-red-100"})})}),(0,s.jsx)("td",{className:"px-6 py-4 text-gray-500 text-lg max-w-xs truncate text-center",children:e.memo||"-"}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("div",{className:"flex flex-col",children:(0,s.jsxs)("div",{className:"font-medium text-gray-700 flex items-center gap-2",children:[(0,s.jsx)(W.A,{className:"w-5 h-5 text-gray-400"})," ",a]})})})]},e.id)}),0===F.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"px-6 py-12 text-center text-gray-500 text-lg",children:"条件に一致する患者が見つかりません"})})]})]}),(0,s.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["全 ",E.length," 件中 ",Math.min((_-1)*20+1,E.length)," - ",Math.min(20*_,E.length)," 件を表示"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>I(e=>Math.max(1,e-1)),disabled:1===_,className:"p-2 rounded hover:bg-gray-200 disabled:opacity-30 disabled:cursor-not-allowed",children:(0,s.jsx)(R.A,{className:"w-6 h-6"})}),(0,s.jsxs)("span",{className:"text-lg font-medium text-gray-700 px-2",children:["page ",_," / ",Math.max(1,O)]}),(0,s.jsx)("button",{onClick:()=>I(e=>Math.min(O,e+1)),disabled:_===O||0===O,className:"p-2 rounded hover:bg-gray-200 disabled:opacity-30 disabled:cursor-not-allowed",children:(0,s.jsx)(Y.A,{className:"w-6 h-6"})})]})]})]})})]})},en=()=>{let[e,t]=(0,l.useState)("ward"),[a,r]=(0,l.useState)(!0),[c,x]=(0,l.useState)([]),[m,g]=(0,l.useState)([]),[u,f]=(0,l.useState)([]),[y,j]=(0,l.useState)(!1),[w,k]=(0,l.useState)(null),[D,C]=(0,l.useState)(null),[A,_]=(0,l.useState)(null);(0,l.useEffect)(()=>{I()},[]);let I=()=>{x(v()),g(N()),f(S())},E=e=>{let t=new Date().toISOString().split("T")[0],a=e.startDate,s=e.endDate;return(!a||!(a>t))&&(!s||!(s<t))},O=a?c.filter(E):c,F=a?m.filter(E):m,T=a?u.filter(E):u,J=()=>{j(!1),k(null),C(null),_(null)};return(0,s.jsxs)("div",{className:"flex flex-col h-full bg-gray-50 text-gray-900 p-8",children:[(0,s.jsxs)("h2",{className:"text-3xl font-bold mb-8 flex items-center gap-3 text-gray-800",children:[(0,s.jsx)(d.A,{className:"w-8 h-8 text-gray-500"})," マスタ設定"]}),(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-300 mb-6",children:[(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("button",{onClick:()=>t("ward"),className:"px-6 py-3 font-bold text-xl flex items-center gap-2 border-b-4 transition-colors ".concat("ward"===e?"border-blue-500 text-blue-800":"border-transparent text-gray-400 hover:text-gray-600"),children:[(0,s.jsx)(i.A,{className:"w-6 h-6"})," 病棟マスタ"]}),(0,s.jsxs)("button",{onClick:()=>t("room"),className:"px-6 py-3 font-bold text-xl flex items-center gap-2 border-b-4 transition-colors ".concat("room"===e?"border-blue-500 text-blue-800":"border-transparent text-gray-400 hover:text-gray-600"),children:[(0,s.jsx)(o.A,{className:"w-6 h-6"})," 病室マスタ"]}),(0,s.jsxs)("button",{onClick:()=>t("user"),className:"px-6 py-3 font-bold text-xl flex items-center gap-2 border-b-4 transition-colors ".concat("user"===e?"border-blue-500 text-blue-800":"border-transparent text-gray-400 hover:text-gray-600"),children:[(0,s.jsx)(n.A,{className:"w-6 h-6"})," アカウントマスタ"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded border border-gray-200 shadow-sm",children:[(0,s.jsx)("input",{type:"checkbox",id:"showValidOnly",checked:a,onChange:e=>r(e.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,s.jsx)("label",{htmlFor:"showValidOnly",className:"text-gray-700 font-bold cursor-pointer select-none",children:"有効なマスタのみ表示"})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow border border-gray-200 overflow-hidden flex-1 flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[(0,s.jsxs)("div",{className:"text-gray-500 font-bold",children:["ward"===e&&"".concat(O.length," 件の病棟"),"room"===e&&"".concat(F.length," 件の病室"),"user"===e&&"".concat(T.length," 件のアカウント")]}),(0,s.jsxs)("button",{onClick:()=>{"ward"===e&&(k({code:"",name:"",type:"一般病棟",startDate:"",endDate:""}),j(!0)),"room"===e&&(C({code:"",name:"",startDate:"",endDate:""}),j(!0)),"user"===e&&(_({id:"u_".concat(Date.now()),userId:"",name:"",password:"",role:"入力者",authority:"一般アカウント",startDate:new Date().toISOString().split("T")[0]}),j(!0))},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 transition",children:[(0,s.jsx)(Z.A,{className:"w-5 h-5"})," 新規追加"]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto",children:(0,s.jsxs)("table",{className:"w-full text-left",children:[(0,s.jsx)("thead",{className:"bg-gray-100 text-gray-600 font-bold border-b border-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3",children:"ID/コード"}),(0,s.jsx)("th",{className:"px-6 py-3",children:"名称"}),"ward"===e&&(0,s.jsx)("th",{className:"px-6 py-3",children:"タイプ"}),"user"===e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("th",{className:"px-6 py-3",children:"ユーザータイプ"}),(0,s.jsx)("th",{className:"px-6 py-3",children:"権限"})]}):null,(0,s.jsx)("th",{className:"px-6 py-3",children:"開始日"}),(0,s.jsx)("th",{className:"px-6 py-3",children:"終了日"}),(0,s.jsx)("th",{className:"px-6 py-3 w-24 text-center",children:"操作"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-100 text-lg",children:["ward"===e&&O.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-blue-50/50",children:[(0,s.jsx)("td",{className:"px-6 py-4 font-mono",children:e.code}),(0,s.jsx)("td",{className:"px-6 py-4 font-bold",children:e.name}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("span",{className:"bg-gray-200 px-2 py-1 rounded text-sm text-gray-700",children:e.type})}),(0,s.jsx)("td",{className:"px-6 py-4 font-mono text-gray-500",children:e.startDate||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 font-mono text-gray-500",children:e.endDate||"-"}),(0,s.jsxs)("td",{className:"px-6 py-4 flex justify-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>{k({...e}),j(!0)},className:"text-blue-600 hover:bg-blue-100 p-2 rounded",children:(0,s.jsx)(M.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>{var t;return t=e.code,void(confirm("本当に削除しますか？")&&((e=>{let t=v().filter(t=>t.code!==e);return localStorage.setItem(b,JSON.stringify(t))})(t),I()))},className:"text-red-400 hover:bg-red-100 p-2 rounded",children:(0,s.jsx)(P.A,{className:"w-5 h-5"})})]})]},e.code)),"room"===e&&F.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-blue-50/50",children:[(0,s.jsx)("td",{className:"px-6 py-4 font-mono",children:e.code}),(0,s.jsx)("td",{className:"px-6 py-4 font-bold",children:e.name}),(0,s.jsx)("td",{className:"px-6 py-4 font-mono text-gray-500",children:e.startDate||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 font-mono text-gray-500",children:e.endDate||"-"}),(0,s.jsxs)("td",{className:"px-6 py-4 flex justify-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>{C({...e}),j(!0)},className:"text-blue-600 hover:bg-blue-100 p-2 rounded",children:(0,s.jsx)(M.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>{var t;return t=e.code,void(confirm("本当に削除しますか？")&&((e=>{let t=N().filter(t=>t.code!==e);return localStorage.setItem(h,JSON.stringify(t))})(t),I()))},className:"text-red-400 hover:bg-red-100 p-2 rounded",children:(0,s.jsx)(P.A,{className:"w-5 h-5"})})]})]},e.code)),"user"===e&&T.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-blue-50/50",children:[(0,s.jsx)("td",{className:"px-6 py-4 font-mono",children:e.userId}),(0,s.jsx)("td",{className:"px-6 py-4 font-bold",children:e.name}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded text-sm text-white font-bold\n                                            ".concat("管理者"===e.role?"bg-purple-500":"評価者"===e.role?"bg-green-500":"bg-blue-400","\n                                        "),children:e.role})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.authority}),(0,s.jsx)("td",{className:"px-6 py-4 font-mono text-gray-500",children:e.startDate||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 font-mono text-gray-500",children:e.endDate||"-"}),(0,s.jsxs)("td",{className:"px-6 py-4 flex justify-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>{_({...e}),j(!0)},className:"text-blue-600 hover:bg-blue-100 p-2 rounded",children:(0,s.jsx)(M.A,{className:"w-5 h-5"})}),"システム管理者アカウント"!==e.authority&&(0,s.jsx)("button",{onClick:()=>(e=>{if("システム管理者アカウント"===e.authority)return void alert("システム管理者アカウントは削除できません。");confirm("本当に削除しますか？\n\n※ユーザーは削除せず「終了日」を設定して無効化することを推奨します。")&&((e=>{let t=S().filter(t=>t.id!==e);return localStorage.setItem(p,JSON.stringify(t))})(e.id),I())})(e),className:"text-red-400 hover:bg-red-100 p-2 rounded",children:(0,s.jsx)(P.A,{className:"w-5 h-5"})})]})]},e.id))]})]})})]}),(()=>{if(!y)return null;let t="",a=null;return"ward"===e&&(t="病棟マスタ編集",a=(0,s.jsx)(i.A,{})),"room"===e&&(t="病室マスタ編集",a=(0,s.jsx)(o.A,{})),"user"===e&&(t="アカウント編集",a=(0,s.jsx)(n.A,{})),(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-8 w-[600px] shadow-xl",children:[(0,s.jsxs)("h3",{className:"text-2xl font-bold mb-6 flex items-center gap-2 text-gray-800",children:[a," ",t]}),(0,s.jsxs)("div",{className:"space-y-6",children:[("ward"===e||"room"===e)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"コード"}),(0,s.jsx)("input",{className:"w-full border p-2 rounded text-lg font-mono",value:"ward"===e?null==w?void 0:w.code:null==D?void 0:D.code,onChange:t=>"ward"===e?k(e=>e?{...e,code:t.target.value}:null):C(e=>e?{...e,code:t.target.value}:null),placeholder:"W001"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"名称"}),(0,s.jsx)("input",{className:"w-full border p-2 rounded text-lg",value:"ward"===e?null==w?void 0:w.name:null==D?void 0:D.name,onChange:t=>"ward"===e?k(e=>e?{...e,name:t.target.value}:null):C(e=>e?{...e,name:t.target.value}:null),placeholder:"名称"})]})]}),"ward"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"病棟タイプ"}),(0,s.jsxs)("select",{className:"w-full border p-2 rounded text-lg",value:null==w?void 0:w.type,onChange:e=>k(t=>t?{...t,type:e.target.value}:null),children:[(0,s.jsx)("option",{value:"一般病棟",children:"一般病棟"}),(0,s.jsx)("option",{value:"精神病棟",children:"精神病棟"}),(0,s.jsx)("option",{value:"その他",children:"その他"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"開始日"}),(0,s.jsx)("input",{type:"date",className:"w-full border p-2 rounded text-lg",value:"ward"===e?(null==w?void 0:w.startDate)||"":(null==D?void 0:D.startDate)||"",onChange:t=>"ward"===e?k(e=>e?{...e,startDate:t.target.value}:null):C(e=>e?{...e,startDate:t.target.value}:null)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"終了日"}),(0,s.jsx)("input",{type:"date",className:"w-full border p-2 rounded text-lg",value:"ward"===e?(null==w?void 0:w.endDate)||"":(null==D?void 0:D.endDate)||"",onChange:t=>"ward"===e?k(e=>e?{...e,endDate:t.target.value}:null):C(e=>e?{...e,endDate:t.target.value}:null)})]})]})]}),"user"===e&&A&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"ユーザーID"}),(0,s.jsx)("input",{className:"w-full border p-2 rounded text-lg font-mono disabled:bg-gray-100 disabled:text-gray-400",value:A.userId,onChange:e=>_(t=>t?{...t,userId:e.target.value}:null),placeholder:"login_id",disabled:"システム管理者アカウント"===A.authority})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"氏名"}),(0,s.jsx)("input",{className:"w-full border p-2 rounded text-lg",value:A.name,onChange:e=>_(t=>t?{...t,name:e.target.value}:null),placeholder:"看護 太郎"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"パスワード"}),(0,s.jsx)("input",{type:"password",className:"w-full border p-2 rounded text-lg font-mono",value:A.password,onChange:e=>_(t=>t?{...t,password:e.target.value}:null),placeholder:"password"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"ユーザータイプ (役割)"}),(0,s.jsxs)("select",{className:"w-full border p-2 rounded text-lg",value:A.role,onChange:e=>_(t=>t?{...t,role:e.target.value}:null),children:[(0,s.jsx)("option",{value:"入力者",children:"入力者"}),(0,s.jsx)("option",{value:"評価者",children:"評価者"}),(0,s.jsx)("option",{value:"管理者",children:"管理者"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"アカウント権限"}),"システム管理者アカウント"===A.authority?(0,s.jsx)("div",{className:"w-full border p-2 rounded text-lg bg-gray-100 text-gray-500",children:"システム管理者アカウント"}):(0,s.jsxs)("select",{className:"w-full border p-2 rounded text-lg",value:A.authority,onChange:e=>_(t=>t?{...t,authority:e.target.value}:null),children:[(0,s.jsx)("option",{value:"一般アカウント",children:"一般アカウント"}),(0,s.jsx)("option",{value:"施設管理者アカウント",children:"施設管理者アカウント"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 border-t pt-4 mt-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"適用開始日"}),(0,s.jsx)("input",{type:"date",className:"w-full border p-2 rounded text-lg",value:A.startDate||"",onChange:e=>_(t=>t?{...t,startDate:e.target.value}:null)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-gray-500 mb-1",children:"適用終了日"}),(0,s.jsx)("input",{type:"date",className:"w-full border p-2 rounded text-lg",value:A.endDate||"",onChange:e=>_(t=>t?{...t,endDate:e.target.value}:null)})]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-8",children:[(0,s.jsx)("button",{onClick:J,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-bold",children:"キャンセル"}),(0,s.jsxs)("button",{onClick:()=>{"ward"===e&&w&&w.code&&w.name&&((e=>{let t=v(),a=t.findIndex(t=>t.code===e.code),s=a>=0?t.map((t,s)=>s===a?e:t):[...t,e];return localStorage.setItem(b,JSON.stringify(s))})(w),j(!1),k(null),I()),"room"===e&&D&&D.code&&D.name&&((e=>{let t=N(),a=t.findIndex(t=>t.code===e.code),s=a>=0?t.map((t,s)=>s===a?e:t):[...t,e];return localStorage.setItem(h,JSON.stringify(s))})(D),j(!1),C(null),I()),"user"===e&&(A&&A.userId&&A.name&&A.password?"システム管理者アカウント"!==A.authority||u.find(e=>e.id===A.id)?((e=>{let t=S(),a=t.findIndex(t=>t.id===e.id),s=a>=0?t.map((t,s)=>s===a?e:t):[...t,e];return localStorage.setItem(p,JSON.stringify(s))})(A),j(!1),_(null),I()):alert("システム管理者アカウントを新規作成することはできません。"):alert("必須項目を入力してください"))},className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-bold flex items-center gap-2",children:[(0,s.jsx)(z.A,{className:"w-4 h-4"})," 保存"]})]})]})})})()]})};function eo(){let[e,t]=(0,l.useState)("home"),[a,r]=(0,l.useState)(!1);return(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-gray-100 overflow-hidden",children:[(0,s.jsx)(c,{activeTab:e,onTabChange:e=>{if(a){if(!window.confirm("編集中のデータは破棄されますが、移動してもよろしいですか？"))return;r(!1)}t(e)}}),(0,s.jsxs)("main",{className:"flex-1 overflow-hidden relative",children:["home"===e&&(0,s.jsx)(q,{}),"inpatients"===e&&(0,s.jsx)(G,{}),"patients"===e&&(0,s.jsx)(er,{onEditingChange:r}),"wards"===e&&(0,s.jsx)(Q,{}),"settings"===e&&(0,s.jsx)(en,{})]})]})}}},e=>{e.O(0,[24,441,255,358],()=>e(e.s=6387)),_N_E=e.O()}]);